<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ToadBox Bingo Boards</title>
  <link rel="stylesheet" href="/css/common.css">
  <link rel="stylesheet" href="/css/index.css">
</head>
<body>
  <h1>ToadBox Bingo Boards</h1>
  <div class="boards-grid" id="boards">
    <div class="loading">Loading boards...</div>
  </div>

  <script type="module">
    import { escapeHtml, formatDate } from '/js/utils.js';
    import { fetchBoards } from '/js/api.js';
    import Logger from '/js/logger.js';

    async function loadBoards() {
      Logger.info('Loading boards');
      try {
        const boards = await fetchBoards();
        Logger.debug('Boards loaded successfully', { count: boards.length });
        updateBoardsDisplay(boards);
      } catch (error) {
        Logger.error('Failed to load boards', { error: error.message });
        document.getElementById('boards').innerHTML = 
          '<p class="error-state">Error loading boards. Please try again later.</p>';
      }
    }

    function updateBoardsDisplay(boards) {
      Logger.debug('Updating boards display', { boardCount: boards.length });
      const boardsGrid = document.getElementById('boards');
      if (boards.length === 0) {
        Logger.info('No boards available');
        boardsGrid.innerHTML = '<p class="empty-state">No boards available. Use /bingo in Discord to get started!</p>';
        return;
      }

      boardsGrid.innerHTML = boards.map(board => `
        <a class="board-card" 
           href="/board/${board.id}"
           role="button"
           tabindex="0">
          <h2>${escapeHtml(board.title)}</h2>
          <p>Created by: ${escapeHtml(board.createdBy || 'Unknown')}</p>
          <p class="last-updated">Last updated: ${formatDate(board.lastUpdated)}</p>
        </a>
      `).join('');
      Logger.info('Boards display updated');
    }

    // Initial load and periodic refresh
    loadBoards();
    setInterval(loadBoards, 5000);
  </script>
</body>
</html>